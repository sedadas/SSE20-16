package at.ac.tuwien.sse.owaspm2.manager;

import android.content.Context;
import android.content.SharedPreferences;

import at.ac.tuwien.sse.owaspm2.entities.AuthenticationData;

public class SharedPrefsAuthenticationStorageManager implements IAuthenticationStorageManager {

    private static final String PREFERENCES_FILE_KEY = "sp_owasp_m2";
    private static final String KEY_SESSION = "session";
    private static final String KEY_USERNAME = "username";

    private SharedPreferences sharedPrefs;

    public SharedPrefsAuthenticationStorageManager(Context context) {
        sharedPrefs = context.getSharedPreferences(PREFERENCES_FILE_KEY, Context.MODE_PRIVATE);
    }

    @Override
    public void save(AuthenticationData authenticationData) {
        SharedPreferences.Editor editor = sharedPrefs.edit();
        editor.putString(KEY_SESSION, authenticationData.getSession());
        editor.putString(KEY_USERNAME, authenticationData.getUsername());
        editor.commit();
    }

    @Override
    public AuthenticationData load() {
        if (!sharedPrefs.contains(KEY_SESSION)) {
            return null;
        }

        String session = sharedPrefs.getString(KEY_SESSION, null);
        String username = sharedPrefs.getString(KEY_USERNAME, null);

        AuthenticationData authData = new AuthenticationData(username, null);
        authData.setSession(session);

        return authData;
    }

    @Override
    public void delete() {
        SharedPreferences.Editor editor = sharedPrefs.edit();
        editor.clear();
        editor.commit();
    }
}
