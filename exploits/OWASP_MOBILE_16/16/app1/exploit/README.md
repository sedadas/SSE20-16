# App0 - M5: Insufficient Cryptography [1]
[toc]

## App Description
With this app, a user can enter his or her credit card information and store them on his or her phone. To save the information, a password is required to encrypt the data. After encryption, the credit card data is stored in the internal storage so that only this app has access to it (like with the first app, as long as we can asume that other apps don't have superuser privilages).

To decrypt and show the credit card information, a user must provid the password that he or she entered during the creation of the credit card entry. Stored credit card information can also be deleted.


## Build
To build the app, run either `build-windows.bat` (Windows) or `build-linux.sh` (Linux). These scripts create an Android-package in the `\app0\src\app\build\outputs\apk\debug` folder called `app-debug.apk`.

The package can be installed on any Android phone with Android 7 or higher. To install the application, the option _"Unknown source"_ in the device settings must be activated.


## Vulnerability
The unpached version of this app uses a class called `OwnEncryptionManager`, which - as the name implies - uses an own implementation to en- and decrypt the data. This is, besides no encryption at all, on of the worst ways to encrypt data [1].

The patched version uses the class `AESEncryptionManager` to encrypt the data. This class follows the Android developer recommandations for encryption[2]. It first generates in 1000 iterations of the _Password-Based Key Derivation Function 2_ (PBKDF2) a key with a random salt and the entered password [3]. Then, for encryption and decryption, it uses the _Advanced Encryption Standard_ (AES) in _Galois/Counter Mode_ (GCM) mode [4],[5]. Finally the resulting byte array gets stored as a Base64 encoded string in the output file within Android's internal storage [6]. The random salt and the initialization vector are both saved as shared preferences in the internal storage as well[7].


## References
[1] OWASP, M5: Insufficient Cryptography, last accessed on 2020-05-20: https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography
[2] Android Developers, Cryptography, last accessed on 2020-05-20: https://developer.android.com/guide/topics/security/cryptography
[3] Wikipedia, PBKDF2, last accessed on 2020-05-20: https://en.wikipedia.org/wiki/PBKDF2
[4] Wikipedia, Advanced Encryption Standard, last accessed on 2020-05-20: https://en.wikipedia.org/wiki/Advanced_Encryption_Standard
[5] Wikipedia, Galois/Counter Mode, last accessed on 2020-05-20: https://en.wikipedia.org/wiki/Galois/Counter_Mode
[6] Android Developers, Access app-specific files, last accessed on 2020-05-20: https://developer.android.com/training/data-storage/app-specific#internal
[7] Android Developers, Save key-value data, last accessed on 2020-05-20: https://developer.android.com/training/data-storage/shared-preferences